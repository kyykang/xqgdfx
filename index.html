<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>需求工单分析系统</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- 页面头部 -->
        <header class="header">
            <h1>📊 需求工单分析系统</h1>
            <p class="subtitle">数据驱动的工单管理洞察</p>
        </header>

        <!-- 文件上传区域 -->
        <section class="upload-section">
            <div class="upload-container">
                <div class="upload-header">
                    <h3>📁 数据文件管理</h3>
                    <p>上传新的Excel文件来更新分析数据</p>
                </div>
                <div class="upload-area" id="upload-area">
                    <div class="upload-content">
                        <div class="upload-icon">📄</div>
                        <p class="upload-text">点击选择文件或拖拽Excel文件到此处</p>
                        <p class="upload-hint">支持 .xlsx 和 .xls 格式</p>
                        <input type="file" id="file-input" accept=".xlsx,.xls" style="display: none;">
                        <button class="upload-btn" onclick="document.getElementById('file-input').click()">选择文件</button>
                    </div>
                </div>
                <div class="upload-status" id="upload-status" style="display: none;">
                    <div class="status-content">
                        <div class="status-icon">⏳</div>
                        <p class="status-text">正在处理文件...</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 概览卡片 -->
        <section class="overview-cards">
            <div class="card">
                <div class="card-icon">📋</div>
                <div class="card-content">
                    <h3 id="total-tickets">-</h3>
                    <p>总工单数</p>
                    <small id="draft-count" style="color: #666; font-size: 0.8em;">其中草稿: -</small>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">🏢</div>
                <div class="card-content">
                    <h3 id="total-departments">-</h3>
                    <p>涉及部门</p>
                </div>
            </div>
            <div class="card">
                <div class="card-icon">📅</div>
                <div class="card-content">
                    <h3 id="date-range">-</h3>
                    <p>数据时间范围</p>
                </div>
            </div>
        </section>

        <!-- 年度筛选器 -->
        <section class="filter-section">
            <div class="filter-container">
                <label for="year-filter">📆 按年度筛选：</label>
                <select id="year-filter">
                    <option value="all">全部年份</option>
                </select>
                <div class="year-stats">
                    <span id="filtered-count">显示全部工单</span>
                </div>
            </div>
        </section>

        <!-- 图表区域 -->
        <section class="charts-grid">
            <!-- 部门TOP10图表 -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 id="dept-title" style="cursor: pointer; transition: color 0.3s;" title="点击查看所有部门详情">🏆 部门工单数量 TOP 10</h2>
                    <p>各部门提交工单数量排名</p>
                    <div class="chart-filter">
                        <label for="dept-year-filter">年度：</label>
                        <select id="dept-year-filter" class="year-filter">
                            <option value="all">全部年份</option>
                        </select>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="exclude-draft-dept" class="exclude-draft-checkbox" checked>
                    <label for="exclude-draft-dept">排除草稿</label>
                        </div>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="show-original-dept" class="show-original-checkbox">
                            <label for="show-original-dept">显示原始部门</label>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="deptChart"></canvas>
                </div>
            </div>

            <!-- 系统勾选统计 -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2>💻 涉及系统统计</h2>
                    <p>OA系统、营销平台、U8C勾选情况</p>
                    <div class="chart-filter">
                        <label for="system-year-filter">年度：</label>
                        <select id="system-year-filter" class="year-filter">
                            <option value="all">全部年份</option>
                        </select>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="exclude-draft-system" class="exclude-draft-checkbox" checked>
                    <label for="exclude-draft-system">排除草稿</label>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="systemChart"></canvas>
                </div>
            </div>

            <!-- 年度趋势图表 -->
            <div class="chart-container full-width">
                <div class="chart-header">
                    <h2>📈 年度工单趋势</h2>
                    <p>各年度工单提交数量变化</p>
                    <div class="chart-filter">
                        <div class="filter-checkbox">
                            <input type="checkbox" id="exclude-draft-year" class="exclude-draft-checkbox" checked>
                    <label for="exclude-draft-year">排除草稿</label>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="yearChart"></canvas>
                </div>
            </div>

            <!-- 工单类型分布 -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2>📊 工单类型分布</h2>
                    <p>不同类型工单的数量分布</p>
                    <div class="chart-filter">
                        <label for="type-year-filter">年度：</label>
                        <select id="type-year-filter" class="year-filter">
                            <option value="all">全部年份</option>
                        </select>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="exclude-draft-type" class="exclude-draft-checkbox" checked>
                    <label for="exclude-draft-type">排除草稿</label>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="typeChart"></canvas>
                </div>
            </div>

            <!-- 工单状态统计 -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2>⚡ 工单状态统计</h2>
                    <p>工单处理状态分布情况</p>
                    <div class="chart-filter">
                        <label for="status-year-filter">年度：</label>
                        <select id="status-year-filter" class="year-filter">
                            <option value="all">全部年份</option>
                        </select>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="exclude-draft" class="exclude-draft-checkbox" checked>
                    <label for="exclude-draft">排除草稿</label>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>

            <!-- 月度趋势 -->
            <div class="chart-container full-width">
                <div class="chart-header">
                    <h2>📅 月度工单趋势</h2>
                    <p>按月份统计的工单提交趋势</p>
                    <div class="chart-filter">
                        <label for="monthly-year-filter">年度：</label>
                        <select id="monthly-year-filter" class="year-filter">
                            <option value="all">全部年份</option>
                        </select>
                        <div class="filter-checkbox">
                            <input type="checkbox" id="exclude-draft-monthly" class="exclude-draft-checkbox" checked>
                    <label for="exclude-draft-monthly">排除草稿</label>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>
        </section>

        <!-- 页脚 -->
        <footer class="footer">
            <p>© 2024 需求工单分析系统 | 数据更新时间: <span id="update-time"></span></p>
        </footer>
    </div>

    <!-- 部门详情模态框 -->
    <div id="dept-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📊 所有部门工单统计</h3>
                <span class="close" id="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="modal-filters">
                    <label for="modal-year-filter">年度：</label>
                    <select id="modal-year-filter">
                        <option value="all">全部年份</option>
                    </select>
                    <div class="filter-checkbox">
                        <input type="checkbox" id="modal-exclude-draft" checked>
                        <label for="modal-exclude-draft">排除草稿</label>
                    </div>
                    <div class="filter-checkbox">
                        <input type="checkbox" id="modal-show-original-dept">
                        <label for="modal-show-original-dept">显示原始部门</label>
                    </div>
                </div>
                <div class="dept-list-container">
                    <table class="dept-table">
                        <thead>
                            <tr>
                                <th>排名</th>
                                <th>部门名称</th>
                                <th>工单数量</th>
                            </tr>
                        </thead>
                        <tbody id="dept-table-body">
                            <!-- 部门数据将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>